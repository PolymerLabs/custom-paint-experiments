<link rel="import" href="paint-underlay.html">
<link rel="import" href="paint-lib.html">
<style>
textarea {
  background: transparent;
}
canvas {
  width: 100vw;
  height: 100vh;
  image-rendering: pixelated;
}
body {
  margin: 0;
  overflow: hidden;
}
</style>
<canvas id=canvas></canvas>
<script>
class WebComponents {
  static get inputProperties() {
    return ['r'];
  }
  paint(ctx, geom, properties) {

    var r = properties.get('r').cssText.replace('px', '');

    var scale = 0.8 * Math.min(geom.width/161, geom.height/132);
    ctx.translate(geom.width/2, geom.height/2);
    ctx.scale(scale, scale);
    ctx.rotate(parseFloat(r) * Math.PI / 180);
    ctx.translate(-161/2, -132/2);

    function path(path, fill) {
      ctx.save();
      ctx.clip(new Path2D(path));
      ctx.fillStyle = fill;
      ctx.fillRect(0, 0, 10 * geom.width, 10 * geom.height);
      ctx.restore();
    }

    function gradient(a, b) {
      var gradient = ctx.createLinearGradient(0, 132/2, 161, 132/2);
      gradient.addColorStop(0, a);
      gradient.addColorStop(1, b);
      return gradient;
    }

    path("M160.6 65.9l-17.4 29.3-24.4-29.7 24.4-28.9z", '#166DA5');
    path("M141.3 100.2l-26.5-31.7-15.9 26.6 24.7 36.1z", '#8FDB69');
    path("M141 31.4l-26.2 31.8-15.9-26.6L123.6.9z", '#166DA5');
    path("M78.6 130.8L41 65.8 79.1.8H37.9L.4 65.8l37.5 65z", '#010101');

    ctx.globalAlpha = 0.95;
    path('M61.1 31.4H141L123.4.9H78.7z M114.8 63.3H159l-15.9-26.8H98.8', gradient('#2A3B8F', '#29ABE2'));
    path('M141.3 100.3H61l17.6 30.5h45z M114.8 68.4H159l-15.9 26.8H98.8', gradient('#E7F716', '#B4D44E'));
  }
}

var cp = new CanvasPainter({
  paintCtor: WebComponents,
  canvas,
  ratio: 0.05,
});

var anim = canvas.animate({
  r: ['0px', '360px'],
}, {
  duration: 5000,
  easing: 'linear',
  iterations: Infinity,
});

function loop(t) {
  cp.updateGeometry(canvas);
  cp.updateStyle(canvas);
  cp.repaint();
  requestAnimationFrame(loop);
}
loop();
</script>
